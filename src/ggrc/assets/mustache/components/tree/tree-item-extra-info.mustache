{{!
    Copyright (C) 2017 Google Inc.
    Licensed under http://www.apache.org/licenses/LICENSE-2.0 <see LICENSE file>
}}

{{#if isActive}}
  <div class="person-holder">
    <i class="fa fa-info-circle {{extraClasses}} person-tooltip-trigger"
       data-placement="left"></i>
    <div class="custom-popover-content">
      <div class="preview-container person-preview">
        {{#if isDirective}}
          <h3 class="task-list-title">Number of mapped objects</h3>
          {{#if_instance_of instance 'Contract'}}
              <div class="counter">
                <i class="fa fa-paragraph"></i> Clauses:
                {{#with_mapping_count instance 'clauses'}}
                  {{count}}
                {{/with_mapping_count}}
              </div>
          {{else}}
              <div class="counter">
                <i class="fa fa-paragraph"></i> Sections:
                {{#with_mapping_count instance 'sections'}}
                  {{count}}
                {{/with_mapping_count}}
              </div>
          {{/if_instance_of}}
        {{/if}}
        {{#if isSection}}
          <h3 class="task-list-title">Number of mapped objects</h3>
          {{#with_mapping_count instance 'related_objects'}}
            {{#prune_context}}
                <i class="fa fa-list-alt"></i> Total:
                {{#if count}}
                  <span class="counter">{{count}}</span>
                {{else}}
                  <strong class="error">0</strong>
                {{/if}}
            {{/prune_context}}
          {{/with_mapping_count}}

          {{#with_mapping_count instance 'objectives'}}
              <i class="fa fa-dot-circle-o"></i> Objectives:
              {{#if count}}
                <span class="counter">{{count}}</span>
              {{else}}
                <strong class="error">0</strong>
              {{/if}}
          {{/with_mapping_count}}

          {{#with_mapping_count instance 'controls'}}
              <i class="fa fa-video-camera"></i> Controls:
              {{#if count}}
                <span class="counter">{{count}}</span>
              {{else}}
                <strong class="error">0</strong>
              {{/if}}
          {{/with_mapping_count}}
        {{/if}}
        {{#if drawStatuses}}
        {{#with_mapping 'object_tasks' instance}}
          <div class="profile-info">
            <h3 class="task-list-title">Current Tasks</h3>
            <ul class="popup-task-list">
              {{#object_tasks}}
                <li>
                  <div class="clearfix">
                    <div class="pull-left">
                      <i class="fa fa-cycle_task_group_object_task"></i>
                    </div>
                    <div class="task-title pull-left">
                      {{instance.title}}
                    </div>
                    <div class="task-status pull-left">
                      {{#switch instance.status}}
                        {{#case 'Verified'}}
                          <span class="green"><em>Verified</em></span>
                        {{/case}}
                        {{#case 'Assigned'}}
                          <span class="gray"><em>Assigned</em></span>
                        {{/case}}
                        {{#case 'Finished'}}
                          <span class="blue"><em>Finished</em></span>
                        {{/case}}
                        {{#case 'InProgress'}}
                          <span class="orange"><em>In progress</em></span>
                        {{/case}}
                      {{/switch}}
                      {{^if_equals instance.status 'Verified'}}
                        {{#is_overdue instance.end_date}}
                        <span class="error"><em>Overdue</em></span>
                        {{/is_overdue}}
                      {{/if_equals}}
                    </div>
                  </div>
                </li>
              {{/object_tasks}}
            </ul>
            <a class="info-action" href="{{instance.viewLink}}#task_widget"><i
              class="fa fa-long-arrow-right"></i> Open tasks</a>
          </div>
        {{/with_mapping}}
        {{/if}}
      </div>
    </div>
  </div>
{{/if}}
